
@{
    Layout = null;
}

<!DOCTYPE html>
<html lang="en">

<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">

    <title>PRUEBA DESARROLLO</title>


    <link href="~/assets/css/bootstrap.min.css" rel="stylesheet">
    <link href="~/assets/css/sb-admin.css" rel="stylesheet">
    <link href="~/assets/font-awesome/css/font-awesome.min.css" rel="stylesheet" type="text/css">

    <link href="~/Content/DataTables/datatables.min.css" rel="stylesheet" />
    <link href="~/Content/DataTables/Buttons-1.6.5/css/buttons.dataTables.min.css" rel="stylesheet" />

    <link href="~/Content/DataTables/fixedColumns.dataTables.min.css" rel="stylesheet" />

    <link href="~/Content/alerta/sweetalert.css" rel="stylesheet" />

    <style>
        .loader {
            position: fixed;
            left: 0px;
            top: 0px;
            width: 100%;
            height: 100%;
            z-index: 9999;
            background: url('../../Content/25.gif') 50% 50% no-repeat rgb(249,249,249);
            opacity: .8;
        }
    </style>


</head>

<body>
    <div class="loader" id="loader"></div>

    <div id="wrapper">
        <div id="page-wrapper">

            <div class="container-fluid">

                <div class="row">
                    <div class="col-lg-12 text-center">
                        <h3>ADMINISTRACIÓN CLIENTES</h3>
                    </div>
                </div>


                <div class="row">
                    <div class="col-lg-12">
                        <div class="table-responsive">
                            <table class="table table-hover table-bordered table-sm" cellspacing="0"
                                   width="100%" id="tablaClientes">
                                <thead>
                                    <tr>
                                        <th style="display:none;">Id Cliente</th>
                                        <th>Tipo Docto</th>
                                        <th>Nro Docto</th>
                                        <th>Primer Nombre</th>
                                        <th>Segundo Nombre</th>
                                        <th>Primer Apellido</th>
                                        <th>Segundo Apellido</th>
                                        <th>Celular</th>
                                        <th>Dirección</th>
                                        <th>Email</th>
                                        <th></th>
                                        <th></th>
                                    </tr>
                                </thead>
                                <tbody>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <div class="row">
                    <div class="col-lg-12">
                        <button type="button" class="btn btn-info" id="btnCrearCliente">NUEVO CLIENTE</button>
                    </div>
                </div>
            </div>
        </div>
    </div>



    <div class="modal fade bd-example-modal-lg" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" aria-hidden="true" id="modalNuevoEditar">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">


                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel">NUEVO/EDITAR CLIENTE</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <input type="hidden" class="form-control" name="txtId" id="txtId">

                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-group">
                                <label>Tipo Docto:</label>
                                <input type="text" class="form-control" name="txtTipoDocto" id="txtTipoDocto">
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group">
                                <label>Nro Docto:</label>
                                <input type="text" class="form-control" name="txtNroDocumento" id="txtNroDocumento">
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-group">
                                <label>Primer Nombre:</label>
                                <input type="text" class="form-control" name="txtPrimerNombre" id="txtPrimerNombre">
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group">
                                <label>Segundo Nombre:</label>
                                <input type="text" class="form-control" name="txtSegundoNombre" id="txtSegundoNombre">
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-group">
                                <label>Primer Apellido:</label>
                                <input type="text" class="form-control" name="txtPrimerApellido" id="txtPrimerApellido">
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group">
                                <label>Segundo Apellido:</label>
                                <input type="text" class="form-control" name="txtSegundoApellido" id="txtSegundoApellido">
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-group">
                                <label>Celular:</label>
                                <input type="text" class="form-control" name="txtCelular" id="txtCelular">
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group">
                                <label>Direccion:</label>
                                <input type="text" class="form-control" name="txtDireccion" id="txtDireccion">
                            </div>
                        </div>
                    </div>


                    <div class="row">

                        <div class="col-md-12">
                            <div class="form-group">
                                <label>Correo Electronico:</label>
                                <input type="email" class="form-control" name="txtEmail" id="txtEmail">
                            </div>
                        </div>
                    </div>


                    <br />
                    <div class="row">
                        <div class="col-md-12">
                            <button type="button" class="btn btn-info" id="btnGuardarCliente">GUARDAR</button>
                        </div>
                    </div>


                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancelar</button>

                </div>


            </div>
        </div>
    </div>



    <script src="~/Scripts/jquery-3.4.1.min.js"></script>
    <script src="~/Scripts/bootstrap.min.js"></script>


    @*<script src="//cdn.datatables.net/1.10.20/js/jquery.dataTables.min.js"></script>*@
    <script src="~/Content/DataTables/datatables.min.js"></script>
    <script src="~/Content/DataTables/Buttons-1.6.5/js/dataTables.buttons.min.js"></script>
    <script src="~/Content/DataTables/jszip.min.js"></script>
    <script src="~/Content/DataTables/Buttons-1.6.5/js/buttons.flash.min.js"></script>
    <script src="~/Content/DataTables/Buttons-1.6.5/js/buttons.html5.min.js"></script>
    <script src="~/Content/DataTables/Buttons-1.6.5/js/buttons.print.min.js"></script>
    <script src="~/Content/DataTables/dataTables.fixedColumns.min.js"></script>
    <script src="~/Content/alerta/sweetalert.min.js"></script>


</body>

</html>
<script type="text/javascript">

    function CargarListClientes() {
        document.getElementById("loader").style.display = "block";
        table = $('#tablaClientes').DataTable();
        table.destroy();
        $('#tablaClientes tbody').html("");
          $.ajax({
           url: '@Url.Action("GetListClientes", "Home")',
           data: {},
           crossDomain: true,
           type: 'POST',
           dataType: 'json',
           success: function (data) {


                 jQuery.each(data, function (index, itemData) {

                     var htmlTags = '<tr>' +
                         '<td style="display:none;">' + itemData.id + '</td>' +
                         '<td>' + itemData.tipoDocto + '</td>' +
                         '<td>' + itemData.nroDocto + '</td>' +
                         '<td>' + itemData.primerNombre + '</td>' +
                         '<td>' + itemData.segundoNombre + '</td>' +
                         '<td>' + itemData.primerApellido + '</td>' +
                         '<td>' + itemData.segundoApellido + '</td>' +
                         '<td>' + itemData.celular + '</td>' +
                         '<td>' + itemData.direccion + '</td>' +
                         '<td>' + itemData.email + '</td>' +
                         '<td>  <a href="#" onclick="Eliminar(this.id);" id="' + itemData.id + '" ">Eliminar</a> </td>' +
                         '<td>  <a href="#" onclick="Editar(this.id);" id="' + itemData.id + '" ">Editar</a> </td>' +
                         '</tr>';


                     $('#tablaClientes tbody').append(htmlTags);


                 });


               $('#tablaClientes').DataTable();
               document.getElementById("loader").style.display = "none";
             },

               error: function (request, message, error) {
                   alert(message);
                     }
           });

    }

    function Editar(id) {
        $('#modalNuevoEditar').modal();
        Limpiar(0);
        $("#txtId").val(id);
          $.ajax({
           url: '@Url.Action("GetCliente", "Home")',
           data: { "id": id },
           crossDomain: true,
           type: 'POST',
           dataType: 'json',
           success: function (data) {
               $("#txtTipoDocto").val(data.tipoDocto);
               $("#txtNroDocumento").val(data.nroDocto);
               $("#txtPrimerNombre").val(data.primerNombre);
               $("#txtSegundoNombre").val(data.segundoNombre);
               $("#txtPrimerApellido").val(data.primerApellido);
               $("#txtSegundoApellido").val(data.segundoApellido);
               $("#txtCelular").val(data.celular);
               $("#txtDireccion").val(data.direccion);
               $("#txtEmail").val(data.email);

             },

               error: function (request, message, error) {
                   alert(message);
                     }
           });


    }

    function eliminarCliente(id) {
        swal.close();
         $.ajax({
                           url: '@Url.Action("eliminarCliente", "Home")',
                           data: { "id": id },
                           crossDomain: true,
                           type: 'POST',
                           dataType: 'json',
                           success: function (data) {
                               if (data == "") {
                                   swal.close();
                                   setTimeout(function () {

                                       swal("Correcto", "Eliminado correctamente", "success");
                                       CargarListClientes();
                                   }, 500)


                               } else {
                                   swal.close();
                                   setTimeout(function () {
                                       document.getElementById("loader").style.display = "none";
                                       sweetAlert("Error", data, "error");
                                   }, 500)
                               }

                             },

               error: function (request, message, error) {
                   alert(message);
                     }
           });
    }

    function Eliminar(id) {


        swal.close();
        setTimeout(function () {
            swal({
                title: "Confirmación",
                text: "¿Desea Eliminar el cliente?",
                type: "warning",
                showCancelButton: true,
                confirmButtonColor: '#DD6B55',
                confirmButtonText: 'Si',
                cancelButtonText: "No",
                closeOnConfirm: false,
                closeOnCancel: true
            },
                function (isConfirm) {

                    if (isConfirm) {

                        eliminarCliente(id);

                    }

                });
        }, 500)




    }

    function Limpiar(nuevo) {
        $("#txtId").val("");
        $("#txtTipoDocto").val("");
        $("#txtNroDocumento").val("");
        $("#txtPrimerNombre").val("");
        $("#txtSegundoNombre").val("");
        $("#txtPrimerApellido").val("");
        $("#txtSegundoApellido").val("");
        $("#txtCelular").val("");
        $("#txtDireccion").val("");
        $("#txtEmail").val("");
        if (nuevo == 0) {
            $('#txtTipoDocto').attr("readonly", "true");
            $('#txtNroDocumento').attr("readonly", "true");
        } else {
            $("#txtTipoDocto").removeAttr("readonly");
            $("#txtNroDocumento").removeAttr("readonly");
        }
    }


    $(document).ready(function () {
        CargarListClientes();
        document.getElementById("loader").style.display = "none";



        $("#btnCrearCliente").click(function (i) {
            $('#modalNuevoEditar').modal();
            Limpiar(1);
        });

        $("#btnGuardarCliente").click(function (i) {
            $('#modalNuevoEditar').modal('toggle');
            var id = $("#txtId").val();
            var tipo = $("#txtTipoDocto").val();
            var nro = $("#txtNroDocumento").val();
            var primerNom = $("#txtPrimerNombre").val();
            var segundoNom = $("#txtSegundoNombre").val();
            var primerApe = $("#txtPrimerApellido").val();
            var segundoApe = $("#txtSegundoApellido").val();
            var celular = $("#txtCelular").val();
            var direccion = $("#txtDireccion").val();
            var email = $("#txtEmail").val();


            if (tipo == "" || nro == "" || primerNom == "" || segundoNom == "" || primerApe == "" || segundoApe == "" || celular == "" || direccion == "" || email == "") {

                swal.close();
                setTimeout(function () {
                    sweetAlert("Advertencia", "Por favor ingrese todos los datos", "warning");
                }, 500)

            } else {

            var fileData = new FormData();
            fileData.append("tipo", tipo);
            fileData.append("nro", nro);
            fileData.append("primerNom", primerNom);
            fileData.append("segundoNom", segundoNom);
            fileData.append("primerApe", primerApe);
            fileData.append("segundoApe", segundoApe);
            fileData.append("celular", celular);
            fileData.append("direccion", direccion);
            fileData.append("email", email);

                if (id == "") {

                //nuevo
                       document.getElementById("loader").style.display = "block";
                         $.ajax({
                           url: '@Url.Action("guardarCliente", "Home")',
                           data: fileData,
                           crossDomain: true,
                           type: 'POST',
                            processData: false,
                            contentType: false,
                           success: function (data) {

                               if (data == "") {
                                   swal.close();
                                   setTimeout(function () {
                                       document.getElementById("loader").style.display = "none";
                                       swal("Correcto", "Se guardo Correctamente", "success");
                                       limpiar();
                                   }, 500)
                                   CargarListClientes();


                               } else {

                                   swal.close();
                                   setTimeout(function () {
                                       document.getElementById("loader").style.display = "none";
                                       sweetAlert("Error", data, "error");
                                   }, 500)


                               }

                          },

                             error: function (request, message, error) {
                                 document.getElementById("loader").style.display = "none";
                                   alert(message);
                                     }
                           });




                } else {
                    fileData.append("id", id);
                    //actualizar

                     document.getElementById("loader").style.display = "block";
                         $.ajax({
                           url: '@Url.Action("actualizarCliente", "Home")',
                           data: fileData,
                           crossDomain: true,
                           type: 'POST',
                            processData: false,
                            contentType: false,
                           success: function (data) {

                               if (data == "") {
                                   swal.close();
                                   setTimeout(function () {
                                       document.getElementById("loader").style.display = "none";
                                       swal("Correcto", "Se actualizo Correctamente", "success");
                                       limpiar();
                                   }, 500)
                                   CargarListClientes();


                               } else {

                                   swal.close();
                                   setTimeout(function () {
                                       document.getElementById("loader").style.display = "none";
                                       sweetAlert("Error", data, "error");
                                   }, 500)


                               }

                          },

                             error: function (request, message, error) {
                                 document.getElementById("loader").style.display = "none";
                                   alert(message);
                                     }
                           });

                }


            }

        });


    });

</script>
